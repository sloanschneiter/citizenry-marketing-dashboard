<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Citizenry - Marketing Performance Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.1.0"></script>
    <style>
        :root {
            --bg-primary: #FAFAF8;
            --bg-card: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --border: #E5E7EB;
            --accent: #264653;
            --accent-warm: #E76F51;
            --green: #2D6A4F;
            --teal: #2A9D8F;
            --gold: #E9C46A;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border);
        }
        header h1 { font-size: 1.75rem; font-weight: 700; color: var(--accent); margin-bottom: 0.25rem; }
        header .subtitle { font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
        header .meta { font-size: 0.8rem; color: var(--text-muted); }
        .section { margin-bottom: 2.5rem; }
        .section h2 {
            font-size: 1.15rem; font-weight: 600; color: var(--accent);
            margin-bottom: 0.75rem; padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--teal); display: inline-block;
        }
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid var(--border);
        }
        .card canvas { max-height: 380px; }
        .takeaway {
            margin-top: 16px;
            padding: 12px 16px;
            background: #F0F7F4;
            border-left: 3px solid var(--green);
            border-radius: 0 8px 8px 0;
            font-size: 0.85rem;
            color: #1A1A1A;
            line-height: 1.6;
        }
        .takeaway strong { color: var(--green); }
        .chart-note {
            font-size: 0.78rem; color: var(--text-muted);
            margin-top: 12px; font-style: italic;
        }
        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin-top: 12px;
        }
        .data-table th {
            text-align: right; padding: 8px 10px;
            font-weight: 600; color: var(--text-secondary);
            border-bottom: 2px solid var(--border);
            font-size: 0.73rem; text-transform: uppercase; letter-spacing: 0.03em;
            white-space: nowrap;
        }
        .data-table th:first-child { text-align: left; }
        .data-table td {
            text-align: right; padding: 6px 10px;
            border-bottom: 1px solid #f3f4f6; color: var(--text-primary);
            white-space: nowrap;
        }
        .data-table td:first-child { text-align: left; font-weight: 500; }
        .data-table tr:hover { background: #f9fafb; }
        .data-table .pct { color: var(--text-muted); font-size: 0.72rem; }
        .table-scroll { overflow-x: auto; }
        .tab-bar {
            display: flex; gap: 0; margin-bottom: 0; border-bottom: 2px solid var(--border);
        }
        .tab-btn {
            padding: 8px 20px; font-size: 0.82rem; font-family: inherit;
            background: none; border: none; cursor: pointer;
            color: var(--text-muted); font-weight: 500;
            border-bottom: 2px solid transparent; margin-bottom: -2px;
            transition: all 0.15s;
        }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--teal); }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        .roas-tab-panel { display: none; }
        .roas-tab-panel.active { display: block; }
        .roas-good { color: #2D6A4F; font-weight: 600; }
        .roas-ok { color: #92400E; }
        .roas-bad { color: #991B1B; }
        #error {
            display: none; background: #FEF2F2; border: 1px solid #FECACA;
            color: #991B1B; padding: 16px 20px; border-radius: 8px;
            margin-bottom: 2rem; font-size: 0.9rem;
        }
        footer {
            margin-top: 3rem; padding-top: 1.5rem;
            border-top: 1px solid var(--border);
            font-size: 0.75rem; color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div id="error"></div>

    <header>
        <h1>The Citizenry</h1>
        <div class="subtitle">Marketing Efficiency & ROAS Dashboard</div>
        <div class="meta" id="header-meta">Jan 2025 - Feb 2026 MTD</div>
    </header>

    <div class="section" style="margin-top: 0;">
        <h2>Things to Consider Testing or Changing</h2>
        <div class="card" style="background: linear-gradient(135deg, #264653 0%, #2A9D8F 100%); color: #fff;">
            <ol style="padding-left: 1.25rem; margin: 0; font-size: 0.85rem; line-height: 1.75;">
                <li style="margin-bottom: 10px;"><strong>Pause the Furniture and Rugs PMax campaigns.</strong> These category campaigns cannibalized General's high-AOV conversions without generating incremental demand. Total PMax at similar spend: 4.03x ROAS with 2 campaigns (Jan-Apr 2025) vs 2.08x with 4 campaigns (Jan 2026). Pausing should let General recapture rug/furniture conversions and restore its ~$500/conv average. Monitor rev/conv recovery over 3-4 weeks.</li>
                <li style="margin-bottom: 10px;"><strong>Restore full-funnel promotional campaign sets for Meta.</strong> Promotional campaigns still run in 2025, but total promotional spend was cut 69% ($702K to $220K) and the full-funnel structure was gutted. In 2024, each major event had 3-7 dedicated campaigns spanning ASC prospecting + remarketing + retention ($177K for Labor Day, $160K for BFCM). In 2025, events run a single ASC prospecting campaign at a fraction of the budget ($57K for Labor Day, $38K for BFCM). Restoring dedicated downstream campaigns for sale events — and committing event-level budgets closer to 2024 levels — is likely the key to scaling again.</li>
                <li style="margin-bottom: 10px;"><strong>Scale Meta more thoughtfully.</strong> The account reached $270K+/month at 3.5-5.9x ROAS in 2024 — the platform can support it, but not by simply increasing evergreen budgets. Specific things to test:
                    <ul style="margin-top: 6px; padding-left: 1.25rem; list-style-type: disc;">
                        <li style="margin-bottom: 4px;"><strong>Product launch campaign sets:</strong> Run dedicated full-funnel campaigns (ASC prospecting + remarketing + retention) around product drops and collection launches. Launches create urgency through novelty and scarcity without discounting. Test $40-60K over 2-3 weeks per launch.</li>
                        <li style="margin-bottom: 4px;"><strong>Seasonal moment campaigns:</strong> "Spring bedroom refresh", "Summer entertaining", "Fall nesting" — themed campaign sets with fresh creative, time-bounded investment, and dedicated remarketing. The promotional campaigns worked partly because they had a defined start/end and distinct creative, not just because of discounts.</li>
                        <li style="margin-bottom: 4px;"><strong>Catalog + Manual Ads hybrid ASC:</strong> The top-performing 2024 campaign used this format — mixing algorithmic catalog optimization with hand-curated creative. Test as a second ASC alongside Evergreen Catalog to reach different audience segments.</li>
                        <li style="margin-bottom: 4px;"><strong>Scale remarketing only during traffic spikes:</strong> Downstream audiences are finite. Rather than scaling retargeting/retention proportionally with prospecting, only increase downstream budgets when there's a measurable traffic spike (product launch, PR feature) that actually grows the retargeting pool.</li>
                        <li style="margin-bottom: 4px;"><strong>Incrementality holdout test first:</strong> Before spending $250K+ again, run a geo holdout at the current $140K level to measure what share of conversions are truly incremental. This reveals the real ceiling before you hit it.</li>
                    </ul>
                </li>
                <li style="margin-bottom: 10px;"><strong>Run a brand search geo-holdout test.</strong> Paid brand search spends ~$28K/month at 10-20x ROAS, but CZ ranks #1 organically for every brand term including misspellings. When paid brand dropped 95% in June 2025, organic brand clicks barely changed. A 4-week geo-holdout (pause brand ads in 15-20% of markets) would quantify how much of the $340K/year is truly incremental — likely 70-90% is not. Also test PMax incrementality via the same approach, since Google provides no keyword-level transparency for PMax.</li>
                <li style="margin-bottom: 10px;"><strong>Fix Meta UTM tagging (GA4 only).</strong> Meta uses <code style="background: rgba(255,255,255,0.15); padding: 2px 5px; border-radius: 3px;">paid_ig/social</code> and <code style="background: rgba(255,255,255,0.15); padding: 2px 5px; border-radius: 3px;">paid_fb/social</code>, causing GA4 to misclassify ~180K paid sessions/month as "Organic Social." This distorts GA4 channel reports but does not impact Rockerbox MTA attribution or Meta's platform-reported conversions. Lower priority — fix for GA4 reporting accuracy.</li>
            </ol>
        </div>
    </div>

    <div class="section" style="margin-top: 2.5rem;">
        <h2>Efficiency & ROAS Trend</h2>
        <div class="card">
            <canvas id="efficiencyRoasChart"></canvas>
            <div class="chart-note">
                ROAS source: P&L actuals (Jan-Jun 2025), Rockerbox UI (Jul 2025+). Rockerbox undercounts spend by $50-130K+/mo vs P&L.
            </div>
            <div class="takeaway" id="eff-takeaway"></div>
        </div>
    </div>

    <div class="section">
        <h2>Channel Spend Distribution</h2>
        <div class="card">
            <div class="table-scroll" id="spend-table-container"></div>
            <div class="chart-note">
                Jan-Jun 2025: P&L actuals (incl. Trade spend in platform totals). Jul 2025+: Rockerbox platform-reported spend. Does not include agency fees or nonworking costs.
            </div>
            <div class="takeaway" id="spend-takeaway"></div>
        </div>
    </div>

    <div class="section" id="roas-section">
        <h2>Channel ROAS (Attributed)</h2>
        <div class="card">
            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchRoasTab(this, 'even')">Even-Weight MTA</button>
                <button class="tab-btn" onclick="switchRoasTab(this, 'modeled')">Modeled MTA</button>
                <button class="tab-btn" onclick="switchRoasTab(this, 'platform')">Platform</button>
            </div>
            <div id="roas-tab-even" class="roas-tab-panel active">
                <div class="table-scroll" id="roas-even-table-container"></div>
            </div>
            <div id="roas-tab-modeled" class="roas-tab-panel">
                <div class="table-scroll" id="roas-modeled-table-container"></div>
            </div>
            <div id="roas-tab-platform" class="roas-tab-panel">
                <div class="table-scroll" id="roas-platform-table-container"></div>
            </div>
            <div class="chart-note">
                MTA tabs: Attributed Revenue / Platform Spend (Jul 2025+, Nov excluded due to partial BB data).
                Platform tab: Platform-reported purchase conversions / spend (Meta 7d click, Google server-side). Jan 2024+.
            </div>
            <div class="takeaway" id="roas-takeaway"></div>
        </div>
    </div>

    <div class="section" id="rev-section">
        <h2>Channel Revenue Distribution (Attributed)</h2>
        <div class="card">
            <div class="tab-bar">
                <button class="tab-btn active" onclick="switchRevTab(this, 'even')">Even-Weight MTA</button>
                <button class="tab-btn" onclick="switchRevTab(this, 'modeled')">Modeled MTA</button>
            </div>
            <div id="rev-tab-even" class="tab-panel active">
                <div class="table-scroll" id="rev-even-table-container"></div>
            </div>
            <div id="rev-tab-modeled" class="tab-panel">
                <div class="table-scroll" id="rev-modeled-table-container"></div>
            </div>
            <div class="chart-note">
                Even-weight: equal credit to all touchpoints. Modeled (normalized): algorithmic credit distribution.
                Source: Bucket Breakdown (Jul-Nov 2025), Log Level MTA (Dec 2025+).
            </div>
            <div class="takeaway" id="rev-takeaway"></div>
        </div>
    </div>

    <div class="section">
        <h2>PMax Deep Dive</h2>
        <div class="card">
            <div style="font-size: 0.85rem; line-height: 1.75; color: var(--text-primary);">
                <ol style="padding-left: 1.25rem; margin: 0;">
                    <li style="margin-bottom: 10px;"><strong>Total PMax ROAS halved after campaign fragmentation.</strong> At comparable spend (~$123-151K/mo), total PMax ran at 4.03x ROAS with 2 campaigns (Jan-Apr 2025) vs 2.08-2.21x with 4 campaigns (Jan-Feb 2026). 12-22% more spend produced 33-47% less revenue and 13-37% fewer conversions. The category splits did not generate incremental demand.</li>
                    <li style="margin-bottom: 10px;"><strong>Furniture and Rugs campaigns cannibalized General's high-AOV conversions.</strong> General's revenue per conversion dropped from ~$509 to ~$278 — a 45% decline. The timing maps precisely to campaign launches: Furniture PMax (Oct 2025) caused a step-down from $420 to $352/conv; Rugs PMax (Dec 2025) caused another from $347 to $281/conv. The category campaigns now convert at $686/conv (Furniture) and $925/conv (Rugs) — the exact AOV range General used to capture.</li>
                    <li style="margin-bottom: 10px;"><strong>Revenue per conversion collapse is the #1 ROAS driver.</strong> Decomposing General's Feb YoY decline (4.81x to 1.94x): rev/conv drop (-44%) explains more than CVR decline (-22%) or CPC increase (+7%). PMax General now converts 48% orders under $200 (pillows, baskets, bath) because the high-AOV products route to dedicated campaigns instead.</li>
                    <li style="margin-bottom: 10px;"><strong>Category campaigns run at worse ROAS than General achieved with the same products.</strong> Furniture PMax: 1.24-1.72x ROAS. Rugs PMax: 2.93x. General used to convert these products within its broad optimization at 4-5x ROAS. Narrow product feeds compete in tighter auction spaces with higher CPMs and less algorithmic flexibility.</li>
                    <li style="margin-bottom: 10px;"><strong>Bedding PMax (launched Jul 2023) is not the problem.</strong> It coexisted with General during the 4.03x baseline period. The damage came specifically from Furniture (Oct 2025) and Rugs (Dec 2025) launches, which removed the two highest-AOV categories from General's conversion pool.</li>
                    <li style="margin-bottom: 10px;"><strong>Scale-up compounded the damage.</strong> During Aug-Nov 2025, total PMax spend tripled to $434K. General's algorithm learned to chase high-volume, low-AOV conversions to spend the budget. When spend was cut, the algorithm didn't reset — it kept targeting the cheap conversion pool, which is why rev/conv never recovered even at original spend levels.</li>
                    <li style="margin-bottom: 10px;"><strong>A duplicate conversion tag was removed mid-2025.</strong> In Jan-Apr 2025, PMax had two purchase conversion actions firing: a web GTM tag (3,137 conversions) and a server-side GTM tag (2,815 conversions). The web version was removed by Dec 2025, leaving only server-side. Likely a correct cleanup of redundant tracking, but worth noting as a change in the optimization signal during this period.</li>
                    <li style="margin-bottom: 10px;"><strong>The fix is consolidation, not optimization.</strong> General didn't structurally degrade — it got cannibalized. Pausing Furniture and Rugs campaigns should let General recapture high-AOV conversions and restore its ~$500/conv average. If category control is needed, use asset groups within a single campaign rather than separate campaigns to preserve Google's holistic optimization.</li>
                </ol>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Meta Deep Dive</h2>
        <div class="card">
            <div style="font-size: 0.85rem; line-height: 1.75; color: var(--text-primary);">
                <ol style="padding-left: 1.25rem; margin: 0;">
                    <li style="margin-bottom: 10px;"><strong>Meta scaled successfully in 2024 at similar spend levels that failed in 2025.</strong> The account ran $271K (May 2024, 4.71x ROAS), $277K (Aug 2024, 3.51x), and $272K (Nov 2024, 5.87x) with strong performance. In 2025, comparable spend ($289-343K, Aug-Nov) produced 2.0-2.3x ROAS. The platform can support $270K+/month — but the promotional campaign structure changed significantly between the two periods.</li>
                    <li style="margin-bottom: 10px;"><strong>Promotional campaign spend was cut 69% and the full-funnel structure was gutted.</strong> Promotional campaigns continued in 2025 (Labor Day, BFCM, Anniversary Sale, etc.), but total promotional spend dropped from ~$702K in 2024 to ~$220K in 2025. More critically, the structure changed: in 2024, each event had 3-7 dedicated campaigns spanning the full funnel (ASC prospecting + remarketing + catalog remarketing + retention + traffic). In 2025, events were reduced to a single ASC prospecting campaign each — no dedicated remarketing or retention for sale events.</li>
                    <li style="margin-bottom: 10px;"><strong>Per-event spend comparisons tell the story.</strong> Labor Day: $177K across 6 campaigns (2024) vs $57K / 1 campaign (2025). BFCM: $160K across 4 campaigns vs $38K / 1 campaign. Memorial Day: $131K across 7 campaigns vs no equivalent in 2025. Anniversary Sale: $47K across 3 campaigns vs $15K / 1 campaign. The campaigns that converted at scale in 2024 were full-funnel promotional sets — the 2025 versions are prospecting-only at a fraction of the budget.</li>
                    <li style="margin-bottom: 10px;"><strong>Evergreen campaigns absorbed the promotional gap but couldn't convert at the same rates.</strong> Account-level CPMs were stable ($12-22) throughout — the account successfully bought more impressions at similar CPMs. But conversion rates declined at higher spend. Evergreen audiences are lower-intent than sale-motivated audiences. This is why 2024 got 2,378-2,934 conversions at $270K while 2025 got 1,230-1,510.</li>
                    <li style="margin-bottom: 10px;"><strong>Downstream campaigns were also overspent.</strong> Retention: $8-13K at 14-27x ROAS grew to $57-94K at 3.3-3.5x. Retargeting: $10-18K at 8-11x grew to $37-85K at 2.7-3.2x. These 3-7x budget increases drove most of their ROAS decline through diminishing returns.</li>
                    <li style="margin-bottom: 10px;"><strong>Non-purchase spend increased significantly.</strong> Awareness, traffic, add-to-cart, and trade campaigns: $14K (Nov 2024) vs $57K (Nov 2025). These campaigns produce near-zero purchase conversions and dilute overall account ROAS.</li>
                    <li style="margin-bottom: 10px;"><strong>When spend normalized, ROAS recovered.</strong> Feb 2026: $142K total, 3.26x ROAS (12 campaigns). Jan 2025: $119K, 6.43x (13 campaigns). The account is not structurally damaged — it's a spend allocation problem, not a platform problem.</li>
                    <li style="margin-bottom: 10px;"><strong>Direct and organic channels were not impacted.</strong> Direct + Organic Search held 25-29% of total revenue throughout. No measurable brand erosion from the prospecting changes.</li>
                </ol>
                <div style="margin-top: 16px; padding: 14px 18px; background: #FFF7ED; border-left: 3px solid #E76F51; border-radius: 0 8px 8px 0;">
                    <strong style="color: #E76F51;">What made scaling work in 2024 that's missing in 2025?</strong>
                    <ul style="margin-top: 8px; padding-left: 1.25rem;">
                        <li style="margin-bottom: 6px;"><strong>Full-funnel promotional sets:</strong> In 2024, each major event ran dedicated ASC prospecting + remarketing + catalog remarketing + retention campaigns. This meant the promotional audience was worked through the entire funnel — not just reached once via prospecting. In 2025, events run a single ASC prospecting campaign with no dedicated downstream support. Restoring full-funnel promotional sets is likely the key to scaling back to $250K+.</li>
                        <li style="margin-bottom: 6px;"><strong>Event-level budget commitment:</strong> Labor Day 2024 received $177K across its full-funnel set. Labor Day 2025 received $57K in a single campaign — a 68% cut. The events that scaled best had dedicated budget across multiple funnel stages, not just a single top-of-funnel ASC.</li>
                        <li style="margin-bottom: 6px;"><strong>Complementary campaign sets:</strong> In 2024, promotional campaigns (~$60-177K per event) ran alongside evergreen (~$110K), each at proven spend levels. In 2025, evergreen budgets were scaled up to compensate for reduced promotional investment, but evergreen doesn't convert as well at higher spend thresholds.</li>
                        <li style="margin-bottom: 6px;"><strong>Diminishing returns on downstream:</strong> Retention and retargeting budgets should be sized to their audience pools, not scaled in proportion to prospecting. These pools are finite and saturate at lower spend thresholds. During sale events, however, these pools grow naturally from higher traffic, making dedicated promotional remarketing/retention viable.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Google Search Deep Dive</h2>
        <div class="card">
            <div style="font-size: 0.85rem; line-height: 1.75; color: var(--text-primary);">
                <ol style="padding-left: 1.25rem; margin: 0;">
                    <li style="margin-bottom: 10px;"><strong>Brand search spend (~$28K/month, ~$340K/year) is almost certainly not incremental.</strong> Paid brand search runs at 10-20x ROAS — impossibly high for real demand creation. These are people who already decided to buy, typed "the citizenry" into Google, and clicked the ad instead of the organic listing directly below it. CZ ranks #1 organically for every brand term including misspellings (citizenery, citzenry, cotizenry, etc.). The ads are capturing existing demand, not creating it.</li>
                    <li style="margin-bottom: 10px;"><strong>June 2025 provides a natural experiment.</strong> Paid brand spend dropped 95% ($34K to $1.7K) while organic brand clicks barely moved (8,050 to 6,203 — a 23% dip consistent with normal seasonal variation). Organic brand impressions also dropped 16%, suggesting fewer people searched for the brand in June overall, not that removing ads caused a traffic loss. The searchers still found the site.</li>
                    <li style="margin-bottom: 10px;"><strong>PMax keyword data is completely unavailable.</strong> Google reports AD_NETWORK_TYPE = "MIXED" for all PMax traffic — no keyword, search term, or placement breakdown exists. PMax is known to bid heavily on brand terms, which would inflate its reported ROAS. The only way to assess PMax incrementality is a geo-holdout experiment.</li>
                    <li style="margin-bottom: 10px;"><strong>Non-brand paid search is small but genuinely incremental.</strong> At $5-18K/month with 2-4x ROAS, non-brand search is creating real demand. The ROAS is realistic for acquisition spend, unlike brand's inflated 10-20x. This budget could potentially be increased.</li>
                    <li style="margin-bottom: 10px;"><strong>Organic non-brand rankings are weak — significant SEO opportunity.</strong> CZ ranks on page 3+ for high-volume generic terms: "rugs" (position 26, 622K impressions), "area rugs" (position 24, 460K impressions), "throw pillows" (position 30, 275K impressions). Moving to page 1 for even one of these terms would exceed the traffic from the entire brand search budget.</li>
                    <li style="margin-bottom: 10px;"><strong>Niche product terms are a near-term SEO win.</strong> CZ already ranks decently for "imabari towel" (position 13, 3.7% CTR), "layering rugs" (position 16, 3.2% CTR), "linen quilt" (position 12, 1.7% CTR), and "organic linen sheets" (position 8, 2.0% CTR). These are lower-volume but higher-intent terms where content optimization could move CZ to page 1 with moderate effort.</li>
                    <li style="margin-bottom: 10px;"><strong>Brand misspellings are not a valid defense case.</strong> There are 10+ misspellings (citizenery, citzenry, cotizenry, citizenary, citizentry) driving ~5K organic clicks — all rank position 1.0-2.0 organically. Competitors are unlikely to bid on obscure misspellings, and even if they did, the organic listing would still dominate.</li>
                </ol>

                <div style="margin-top: 20px; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--accent);">Paid Brand Search vs Organic Brand Search (Monthly)</div>
                <div class="table-scroll">
                    <table class="data-table" id="brand-search-table">
                        <tr>
                            <th>Month</th>
                            <th>Paid Spend</th>
                            <th>Paid Clicks</th>
                            <th>Paid Rev</th>
                            <th>Paid ROAS</th>
                            <th>Cost/Conv</th>
                            <th>Organic Clicks</th>
                            <th>Total Brand Clicks</th>
                            <th>Paid % of Total</th>
                        </tr>
                        <tr><td>Jan 25</td><td>$24,861</td><td>22,310</td><td>$518,452</td><td><span class="roas-good">20.9x</span></td><td>$27</td><td>8,646</td><td>30,956</td><td>72%</td></tr>
                        <tr><td>Feb 25</td><td>$34,077</td><td>20,986</td><td>$531,079</td><td><span class="roas-good">15.6x</span></td><td>$36</td><td>7,938</td><td>28,924</td><td>73%</td></tr>
                        <tr><td>Mar 25</td><td>$23,326</td><td>19,884</td><td>$386,589</td><td><span class="roas-good">16.6x</span></td><td>$29</td><td>8,248</td><td>28,132</td><td>71%</td></tr>
                        <tr><td>Apr 25</td><td>$32,654</td><td>18,581</td><td>$396,365</td><td><span class="roas-good">12.1x</span></td><td>$45</td><td>7,223</td><td>25,804</td><td>72%</td></tr>
                        <tr><td>May 25</td><td>$34,159</td><td>22,548</td><td>$708,850</td><td><span class="roas-good">20.8x</span></td><td>$30</td><td>8,050</td><td>30,598</td><td>74%</td></tr>
                        <tr style="background: #FEF2F2;"><td>Jun 25</td><td>$1,675</td><td>1,379</td><td>$41,062</td><td><span class="roas-good">24.5x</span></td><td>$21</td><td>6,203</td><td>7,582</td><td>18%</td></tr>
                        <tr><td>Jul 25</td><td>$13,335</td><td>7,968</td><td>$159,600</td><td><span class="roas-good">12.0x</span></td><td>$47</td><td>9,149</td><td>17,117</td><td>47%</td></tr>
                        <tr><td>Aug 25</td><td>$28,941</td><td>17,202</td><td>$352,704</td><td><span class="roas-good">12.2x</span></td><td>$45</td><td>14,065</td><td>31,267</td><td>55%</td></tr>
                        <tr><td>Sep 25</td><td>$32,186</td><td>22,508</td><td>$404,462</td><td><span class="roas-good">12.6x</span></td><td>$41</td><td>6,956</td><td>29,464</td><td>76%</td></tr>
                        <tr><td>Oct 25</td><td>$22,896</td><td>16,214</td><td>$257,210</td><td><span class="roas-good">11.2x</span></td><td>$48</td><td>12,310</td><td>28,524</td><td>57%</td></tr>
                        <tr><td>Nov 25</td><td>$35,620</td><td>19,711</td><td>$526,862</td><td><span class="roas-good">14.8x</span></td><td>$34</td><td>15,276</td><td>34,987</td><td>56%</td></tr>
                        <tr><td>Dec 25</td><td>$32,492</td><td>22,063</td><td>$270,040</td><td><span class="roas-good">8.3x</span></td><td>$50</td><td colspan="3" style="color: var(--text-muted); text-align: center;">GSC data not available</td></tr>
                        <tr><td>Jan 26</td><td>$26,593</td><td>20,964</td><td>$247,396</td><td><span class="roas-good">9.3x</span></td><td>$51</td><td colspan="3" style="color: var(--text-muted); text-align: center;">GSC data not available</td></tr>
                        <tr><td>Feb 26</td><td>$24,123</td><td>17,069</td><td>$276,935</td><td><span class="roas-good">11.5x</span></td><td>$39</td><td colspan="3" style="color: var(--text-muted); text-align: center;">GSC data not available</td></tr>
                    </table>
                </div>
                <div class="chart-note">June 2025 highlighted: paid brand spend dropped 95% while organic brand clicks barely changed. Paid revenue = Google Ads platform-reported (server-side GTM). GSC data available through Nov 2025 only.</div>

                <div style="margin-top: 24px; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; color: var(--accent);">Organic Non-Brand SEO Opportunities (Jan-Nov 2025)</div>
                <div class="table-scroll">
                    <table class="data-table">
                        <tr>
                            <th>Keyword</th>
                            <th>Clicks</th>
                            <th>Impressions</th>
                            <th>Avg Position</th>
                            <th>CTR</th>
                            <th>Opportunity</th>
                        </tr>
                        <tr><td>rugs</td><td>1,579</td><td>621,639</td><td>25.7</td><td>0.25%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 3</td></tr>
                        <tr><td>area rugs</td><td>1,069</td><td>459,813</td><td>24.3</td><td>0.23%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 3</td></tr>
                        <tr><td>throw pillows</td><td>1,052</td><td>275,129</td><td>30.2</td><td>0.38%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 3+</td></tr>
                        <tr><td>lumbar pillow</td><td>1,090</td><td>218,012</td><td>8.6</td><td>0.50%</td><td style="color: var(--gold); font-weight: 500;">Page 1 edge</td></tr>
                        <tr><td>linen duvet cover</td><td>825</td><td>76,341</td><td>21.4</td><td>1.08%</td><td style="color: var(--accent-warm); font-weight: 500;">Mid volume, page 2-3</td></tr>
                        <tr><td>imabari towel</td><td>883</td><td>23,687</td><td>13.2</td><td>3.73%</td><td style="color: var(--green); font-weight: 500;">Niche, near page 1</td></tr>
                        <tr><td>layering rugs</td><td>737</td><td>23,078</td><td>15.9</td><td>3.19%</td><td style="color: var(--green); font-weight: 500;">Niche, near page 1</td></tr>
                        <tr><td>linen quilt</td><td>512</td><td>29,407</td><td>12.0</td><td>1.74%</td><td style="color: var(--green); font-weight: 500;">Niche, near page 1</td></tr>
                        <tr><td>organic linen sheets</td><td>342</td><td>17,414</td><td>8.4</td><td>1.96%</td><td style="color: var(--green); font-weight: 500;">Niche, page 1 edge</td></tr>
                        <tr><td>custom furniture</td><td>437</td><td>143,634</td><td>15.0</td><td>0.30%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 2</td></tr>
                        <tr><td>linen sheets</td><td>410</td><td>135,640</td><td>27.4</td><td>0.30%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 3</td></tr>
                        <tr><td>jute rug</td><td>516</td><td>193,986</td><td>25.2</td><td>0.27%</td><td style="color: var(--accent-warm); font-weight: 500;">High volume, page 3</td></tr>
                    </table>
                </div>
                <div class="chart-note">Source: Google Search Console (Jan-Nov 2025). "Page 1 edge" = position 8-10, "Near page 1" = position 11-16. Moving from position 25 to position 5 typically increases CTR 10-20x.</div>

                <div style="margin-top: 16px; padding: 14px 18px; background: #FFF7ED; border-left: 3px solid #E76F51; border-radius: 0 8px 8px 0;">
                    <strong style="color: #E76F51;">Recommended: Run a brand search geo-holdout test.</strong>
                    <ul style="margin-top: 8px; padding-left: 1.25rem;">
                        <li style="margin-bottom: 6px;"><strong>Test design:</strong> Pause brand search ads in 15-20% of markets (by geo) for 4 weeks. Measure total site revenue from test markets vs control markets. If revenue doesn't decline, brand search is not incremental and the $340K/year can be reallocated.</li>
                        <li style="margin-bottom: 6px;"><strong>Expected outcome:</strong> Based on the June 2025 natural experiment and 10-20x ROAS (indicating demand capture, not creation), brand search spend is likely 70-90% non-incremental. Even a conservative 50% reduction would free up $170K/year.</li>
                        <li style="margin-bottom: 6px;"><strong>Where to reallocate:</strong> Non-brand paid search (currently only $5-18K/month at 2-4x ROAS — actual demand creation), SEO investment for high-volume category terms, or Meta prospecting campaigns.</li>
                        <li style="margin-bottom: 6px;"><strong>PMax incrementality test:</strong> Same geo-holdout approach. Pause PMax in test markets to measure how much of its reported revenue is truly incremental vs brand term capture. This is the only way to assess PMax since Google provides no keyword-level transparency.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <footer id="footer">
        Data sources: Snowflake (PROD.ANALYTICS_CITIZENRY, ROCKERBOX_CITIZENRY.PUBLIC), P&L actuals from brief.
    </footer>

    <script>
    const COLORS = {
        efficiency: '#2D6A4F',
        plRoas: '#264653',
        rbRoas: '#E76F51',
    };

    function fmt$(n) { return '$' + (n || 0).toLocaleString(); }
    function fmtPct(n) { return (n || 0).toFixed(1) + '%'; }
    function monthLabel(m) {
        const [y, mo] = m.split('-');
        const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        return months[parseInt(mo) - 1] + ' ' + y.slice(2);
    }

    function switchRevTab(btn, tab) {
        const section = document.getElementById('rev-section');
        section.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        section.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('rev-tab-' + tab).classList.add('active');
        btn.classList.add('active');
    }

    function switchRoasTab(btn, tab) {
        const section = document.getElementById('roas-section');
        section.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        section.querySelectorAll('.roas-tab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('roas-tab-' + tab).classList.add('active');
        btn.classList.add('active');
    }

    // =========================================================================
    // Chart 1: Efficiency & ROAS (exclude P&L once RB available)
    // =========================================================================
    function renderEfficiencyRoasChart(items) {
        const labels = items.map(d => monthLabel(d.month));
        const effData = items.map(d => d.efficiency_pct);

        // Total ROAS: P&L for Jan-Jun 2025, Rockerbox for Jul 2025+
        // Exclude P&L ROAS once Rockerbox is available
        const roasData = items.map(d => d.total_roas);

        const boundaryIdx = items.findIndex(d => d.roas_source === 'Rockerbox');

        new Chart(document.getElementById('efficiencyRoasChart'), {
            type: 'line',
            data: {
                labels,
                datasets: [
                    {
                        label: 'Efficiency %',
                        data: effData,
                        yAxisID: 'y',
                        borderColor: COLORS.efficiency,
                        backgroundColor: COLORS.efficiency + '15',
                        borderWidth: 2.5,
                        pointRadius: 4,
                        pointBackgroundColor: COLORS.efficiency,
                        tension: 0.3,
                        fill: true,
                    },
                    {
                        label: 'ROAS',
                        data: roasData,
                        yAxisID: 'y1',
                        borderWidth: 2.5,
                        pointRadius: 4,
                        tension: 0.3,
                        spanGaps: false,
                        segment: {
                            borderColor: ctx => ctx.p0DataIndex < boundaryIdx ? COLORS.plRoas : COLORS.rbRoas,
                        },
                        pointBackgroundColor: roasData.map((_, i) => i < boundaryIdx ? COLORS.plRoas : COLORS.rbRoas),
                        borderColor: COLORS.plRoas,
                    },
                ]
            },
            options: {
                responsive: true,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top', labels: { usePointStyle: true, padding: 16, font: { size: 12 } } },
                    annotation: {
                        annotations: {
                            sourceChange: {
                                type: 'line',
                                xMin: boundaryIdx - 0.5, xMax: boundaryIdx - 0.5,
                                borderColor: '#bbb', borderDash: [4, 4], borderWidth: 1,
                                label: {
                                    content: 'P&L ROAS  |  Rockerbox ROAS',
                                    display: true, position: 'start',
                                    backgroundColor: 'rgba(0,0,0,0.55)', color: '#fff',
                                    font: { size: 10 }, padding: 4,
                                }
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(ctx) {
                                if (ctx.dataset.yAxisID === 'y') return ctx.dataset.label + ': ' + fmtPct(ctx.raw);
                                const src = items[ctx.dataIndex].roas_source;
                                return 'ROAS (' + src + '): ' + (ctx.raw ? ctx.raw.toFixed(2) + 'x' : 'N/A');
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        type: 'linear', position: 'left',
                        title: { display: true, text: 'Efficiency %', font: { size: 12 } },
                        min: 50, max: 95,
                        ticks: { callback: v => v + '%' },
                        grid: { color: '#f0f0f0' },
                    },
                    y1: {
                        type: 'linear', position: 'right',
                        title: { display: true, text: 'ROAS', font: { size: 12 } },
                        min: 0, max: 7,
                        ticks: { callback: v => v.toFixed(1) + 'x' },
                        grid: { drawOnChartArea: false },
                    }
                }
            }
        });

        // Takeaway
        document.getElementById('eff-takeaway').innerHTML =
            '<strong>Takeaway:</strong> Efficiency and ROAS began diverging in March 2025. ' +
            'Efficiency climbed to 85-87% (Mar-May) while ROAS continued declining from 4.43x to the 3.4x range. ' +
            'The two metrics are inversely correlated (r = -0.48), driven by the shift toward high-AOV MTO items ' +
            '(which score well on efficiency) while paid media costs increased faster than revenue.';
    }

    // =========================================================================
    // Channel Spend Table
    // =========================================================================
    function renderChannelSpendTable(items) {
        const buckets = ['Paid Social', 'PMax', 'Paid Search/Shopping', 'Direct Mail', 'Affiliate'];

        let html = '<table class="data-table"><tr><th>Month</th>';
        buckets.forEach(b => { html += '<th>' + b + '</th>'; });
        html += '<th>Total</th><th>ROAS</th><th>Src</th></tr>';

        items.forEach(d => {
            html += '<tr><td>' + monthLabel(d.month) + '</td>';
            buckets.forEach(b => {
                const val = d[b] || 0;
                const pct = d.total > 0 ? ((val / d.total) * 100).toFixed(1) : '0.0';
                html += '<td>' + fmt$(val) + ' <span class="pct">(' + pct + '%)</span></td>';
            });
            html += '<td>' + fmt$(d.total) + '</td>';
            html += '<td>' + (d.total_roas ? d.total_roas.toFixed(2) + 'x' : '-') + '</td>';
            html += '<td>' + (d.source === 'P&L' ? 'P&L' : 'RB') + '</td></tr>';
        });
        html += '</table>';
        document.getElementById('spend-table-container').innerHTML = html;

        // Takeaway
        const first = items[0];
        const last = items[items.length - 1];
        const peakSpend = items.reduce((max, d) => d.total > max.total ? d : max, items[0]);
        document.getElementById('spend-takeaway').innerHTML =
            '<strong>Takeaway:</strong> Total tracked spend peaked at ' + fmt$(peakSpend.total) +
            ' in ' + monthLabel(peakSpend.month) + ' and has since declined to ' + fmt$(last.total) +
            ' (' + monthLabel(last.month) + '). Paid Social and PMax are the two dominant buckets. ' +
            'Direct Mail spend is volatile (driven by catalog drops). ' +
            'Jan-Jun 2025 uses P&L actuals; Jul 2025+ uses Rockerbox (AGGREGATE_MTA).';
    }

    // =========================================================================
    // Channel Revenue Tables (Even + Modeled)
    // =========================================================================
    function renderChannelRevenueTable(items, containerId) {
        const channelOrder = ['Paid Social', 'Paid Search', 'Performance Max', 'Organic Search', 'Direct', 'Email/SMS', 'Other'];
        let html = '<table class="data-table"><tr><th>Month</th>';
        channelOrder.forEach(ch => { html += '<th>' + ch + '</th>'; });
        html += '<th>Total</th><th>Src</th></tr>';

        items.forEach(d => {
            html += '<tr><td>' + monthLabel(d.month) + '</td>';
            channelOrder.forEach(ch => {
                const val = (d.channels && d.channels[ch]) || 0;
                const pct = d.total > 0 ? ((val / d.total) * 100).toFixed(1) : '0.0';
                html += '<td>' + fmt$(val) + ' <span class="pct">(' + pct + '%)</span></td>';
            });
            html += '<td>' + fmt$(d.total) + '</td>';
            html += '<td>' + (d.source === 'bucket_breakdown' ? 'BB' : 'MTA') + '</td></tr>';
        });
        html += '</table>';
        document.getElementById(containerId).innerHTML = html;
    }

    function renderRevenueSection(evenItems, modeledItems) {
        renderChannelRevenueTable(evenItems, 'rev-even-table-container');
        renderChannelRevenueTable(modeledItems, 'rev-modeled-table-container');

        // Takeaway based on even-weight data
        if (evenItems.length > 0) {
            const first = evenItems[0];
            const last = evenItems[evenItems.length - 1];
            const getPct = (d, ch) => d.total > 0 ? (((d.channels && d.channels[ch]) || 0) / d.total * 100).toFixed(0) : 0;
            document.getElementById('rev-takeaway').innerHTML =
                '<strong>Takeaway:</strong> Paid Social\'s share of attributed revenue declined from ' +
                getPct(first, 'Paid Social') + '% (' + monthLabel(first.month) + ') to ' +
                getPct(last, 'Paid Social') + '% (' + monthLabel(last.month) +
                '), while Organic Search and Direct have remained stable -- indicating paid channels are contributing ' +
                'a shrinking portion of the attribution pie. Performance Max holds a steady ~10-14% share. ' +
                'Compare the Even-Weight and Modeled tabs to see how different attribution methodologies shift credit across channels.';
        }
    }

    // =========================================================================
    // Channel ROAS Table
    // =========================================================================
    function fmtRoas(val) {
        if (val == null) return '-';
        const cls = val >= 3 ? 'roas-good' : val >= 1.5 ? 'roas-ok' : 'roas-bad';
        return '<span class="' + cls + '">' + val.toFixed(2) + 'x</span>';
    }

    function renderChannelRoasTable(items, containerId) {
        const channels = ['Paid Social', 'PMax', 'Paid Search', 'Direct Mail', 'Affiliate'];
        let html = '<table class="data-table"><tr><th>Month</th>';
        channels.forEach(ch => { html += '<th>' + ch + '</th>'; });
        html += '<th>Total</th><th>Src</th></tr>';

        items.forEach(d => {
            html += '<tr><td>' + monthLabel(d.month) + '</td>';
            channels.forEach(ch => {
                const chData = (d.channels && d.channels[ch]) || {};
                const roas = chData.roas;
                const spend = chData.spend || 0;
                const rev = chData.revenue || 0;
                const tooltip = 'Rev: ' + fmt$(rev) + ' / Spend: ' + fmt$(spend);
                html += '<td title="' + tooltip + '">' + fmtRoas(roas) + '</td>';
            });
            html += '<td title="Rev: ' + fmt$(d.total_revenue) + ' / Spend: ' + fmt$(d.total_spend) + '">' + fmtRoas(d.total_roas) + '</td>';
            html += '<td>' + (d.source === 'bucket_breakdown' ? 'BB' : 'MTA') + '</td></tr>';
        });
        html += '</table>';
        document.getElementById(containerId).innerHTML = html;
    }

    function renderPlatformRoasTable(items, containerId) {
        const channels = ['Paid Social', 'PMax', 'Paid Search'];
        let html = '<table class="data-table"><tr><th>Month</th>';
        channels.forEach(ch => { html += '<th>' + ch + '</th>'; });
        html += '<th>Total</th></tr>';

        items.forEach(d => {
            html += '<tr><td>' + monthLabel(d.month) + '</td>';
            channels.forEach(ch => {
                const chData = (d.channels && d.channels[ch]) || {};
                const roas = chData.roas;
                const spend = chData.spend || 0;
                const rev = chData.revenue || 0;
                const tooltip = 'Platform Rev: ' + fmt$(rev) + ' / Spend: ' + fmt$(spend);
                html += '<td title="' + tooltip + '">' + fmtRoas(roas) + '</td>';
            });
            html += '<td title="Rev: ' + fmt$(d.total_revenue) + ' / Spend: ' + fmt$(d.total_spend) + '">' + fmtRoas(d.total_roas) + '</td>';
            html += '</tr>';
        });
        html += '</table>';
        document.getElementById(containerId).innerHTML = html;
    }

    function renderChannelRoasSection(evenItems, modeledItems, platformItems) {
        renderChannelRoasTable(evenItems, 'roas-even-table-container');
        renderChannelRoasTable(modeledItems, 'roas-modeled-table-container');
        renderPlatformRoasTable(platformItems, 'roas-platform-table-container');

        if (evenItems.length > 0) {
            const first = evenItems[0];
            const last = evenItems[evenItems.length - 1];
            const getRoas = (d, ch) => (d.channels && d.channels[ch]) ? d.channels[ch].roas : null;
            const psFirst = getRoas(first, 'Paid Social');
            const psLast = getRoas(last, 'Paid Social');
            const pmFirst = getRoas(first, 'PMax');
            const pmLast = getRoas(last, 'PMax');
            document.getElementById('roas-takeaway').innerHTML =
                '<strong>Takeaway:</strong> Paid Social MTA ROAS declined from ' +
                (psFirst ? psFirst.toFixed(2) + 'x' : 'N/A') + ' (' + monthLabel(first.month) + ') to ' +
                (psLast ? psLast.toFixed(2) + 'x' : 'N/A') + ' (' + monthLabel(last.month) +
                '), while PMax held steadier (' +
                (pmFirst ? pmFirst.toFixed(2) + 'x' : 'N/A') + ' to ' +
                (pmLast ? pmLast.toFixed(2) + 'x' : 'N/A') +
                '). Platform tab shows platform-reported ROAS (Meta 7d click, Google server-side) back to Jan 2024 for longer-term trends. ' +
                'Hover over values for underlying spend and revenue.';
        }
    }

    // =========================================================================
    // Init
    // =========================================================================
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('./dashboard_data.json');
            if (!response.ok) throw new Error('HTTP ' + response.status + '. Run query_dashboard_data.py first.');
            const data = await response.json();

            document.getElementById('header-meta').textContent =
                data.date_range.start + ' - ' + data.date_range.end + ' MTD  |  Generated: ' +
                new Date(data.generated_at).toLocaleDateString();

            renderEfficiencyRoasChart(data.efficiency_roas);
            renderChannelSpendTable(data.channel_spend);
            renderChannelRoasSection(data.channel_roas_even || [], data.channel_roas_modeled || [], data.channel_roas_platform || []);
            renderRevenueSection(data.channel_revenue_even, data.channel_revenue_modeled);

            document.getElementById('footer').textContent +=
                '  |  Generated ' + new Date(data.generated_at).toLocaleString();
        } catch (err) {
            document.getElementById('error').textContent = 'Failed to load dashboard data: ' + err.message;
            document.getElementById('error').style.display = 'block';
        }
    });
    </script>
</body>
</html>
